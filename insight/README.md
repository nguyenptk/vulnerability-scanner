## Insight 
The Insight is service that allow the client can request a report via API to list the vulnerabilities of the repositories in Github. 

Currently, the Insight supports only one API `/report`

## How it works
The Insight will get the information of scanning in database (MySQL)

## What the features are
The Insight supports:
- Get list pagination of reports
- Get report by ID

## How to use
There are two ways to call the Insight:

- Via API-Gateway (recommened)
```
export INSIGHT_PATH=http://localhost:8080/insight/v1/report
```
- Directly
```
export INSIGHT_PATH=http://localhost:9000/report
```

### 1. Get list pagination of reports
```
curl -i -X GET "$INSIGHT_PATH" \
            -H "offset: 0" \
            -H "limit: 10"
```
```
HTTP/1.1 200 OK
content-type: application/json
date: Sat, 04 Jun 2022 07:56:53 GMT
content-length: 1316
x-envoy-upstream-service-time: 3
server: envoy

{
  "limit": 10,
  "message": [
    {
      "id": "696b0651-368a-4195-bfb8-f9e0864bc698",
      "queue_at": "2022-06-04T07:44:32.515Z",
      "started_at": "2022-06-04T07:44:32.515Z",
      "finished_at": "2022-06-04T07:44:35.041Z",
      "status": "Success",
      "progress": 100,
      "targets": 1,
      "repositories": 1,
      "findings": 3,
      "created_at": "2022-06-04T07:44:35.041Z",
      "updated_at": "2022-06-04T07:44:35.041Z"
    },
    {
      "id": "a235709d-615b-4527-b4a5-4cea736bd804",
      "queue_at": "2022-06-04T07:50:57.78Z",
      "started_at": "2022-06-04T07:50:57.78Z",
      "finished_at": "2022-06-04T07:50:59.41Z",
      "status": "Success",
      "progress": 100,
      "targets": 1,
      "repositories": 1,
      "findings": 3,
      "created_at": "2022-06-04T07:50:59.411Z",
      "updated_at": "2022-06-04T07:50:59.411Z"
    },
    {
      "id": "e11ca360-e340-4c52-b994-2d72d893418f",
      "queue_at": "2022-06-04T07:38:15.367Z",
      "started_at": "2022-06-04T07:38:15.367Z",
      "finished_at": "2022-06-04T07:38:17.045Z",
      "status": "Success",
      "progress": 100,
      "targets": 1,
      "repositories": 1,
      "findings": 3,
      "created_at": "2022-06-04T07:38:17.045Z",
      "updated_at": "2022-06-04T07:38:17.045Z"
    },
    {
      "id": "f7881081-8de4-4e35-b72e-856d5ac3db72",
      "queue_at": "2022-06-04T07:32:41.919Z",
      "started_at": "2022-06-04T07:32:41.919Z",
      "finished_at": "2022-06-04T07:32:45.258Z",
      "status": "Success",
      "progress": 100,
      "targets": 1,
      "repositories": 1,
      "findings": 0,
      "created_at": "2022-06-04T07:32:45.258Z",
      "updated_at": "2022-06-04T07:32:45.258Z"
    }
  ],
  "offset": 0
}
```

### 2. Get report by ID
```
curl -i -X GET "$INSIGHT_PATH" \
                -H "id: ${report_id}" # This case is `696b0651-368a-4195-bfb8-f9e0864bc698`
```

```
HTTP/1.1 200 OK
content-type: application/json
date: Sat, 04 Jun 2022 08:05:47 GMT
x-envoy-upstream-service-time: 15
server: envoy
transfer-encoding: chunked

{
  "message": {
    "id": "696b0651-368a-4195-bfb8-f9e0864bc698",
    "queue_at": "2022-06-04T07:44:32.515Z",
    "started_at": "2022-06-04T07:44:32.515Z",
    "finished_at": "2022-06-04T07:44:35.041Z",
    "status": "Success",
    "progress": 100,
    "targets": 1,
    "repositories": 1,
    "findings": 3,
    "created_at": "2022-06-04T07:44:35.041Z",
    "updated_at": "2022-06-04T07:44:35.041Z",
    "vulnerabilities": [
      {
        "id": "4cc6c3ebe85614e5e2a3aede235558fca44e5240c1a50277f819b6b74df77089",
        "report_id": "696b0651-368a-4195-bfb8-f9e0864bc698",
        "repository_name": "nguyenptk/hello-world",
        "repository_url": "https://api.github.com/repos/nguyenptk/hello-world",
        "created_at": "2022-06-04T07:44:35.062Z",
        "updated_at": "2022-06-04T07:44:35.062Z",
        "findings": [
          {
            "id": "b944ec73197694bb5d4bc7e623000e00ba6929257ff2e835002e3738fe4348df",
            "vulnerability_id": "4cc6c3ebe85614e5e2a3aede235558fca44e5240c1a50277f819b6b74df77089",
            "file_path": "test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test.log",
            "created_at": "2022-06-04T07:44:35.069Z",
            "updated_at": "2022-06-04T07:44:35.069Z"
          },
          {
            "id": "e74c0bbe07dfa40cdd99ecfef2531ce9bbaad6125b9b59dc4b5483ad62deab6c",
            "vulnerability_id": "4cc6c3ebe85614e5e2a3aede235558fca44e5240c1a50277f819b6b74df77089",
            "file_path": "test/test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test/test.log",
            "created_at": "2022-06-04T07:44:35.069Z",
            "updated_at": "2022-06-04T07:44:35.069Z"
          },
          {
            "id": "f52c49c27cd4dcf6fe5bc674a840580933e2c002c2a7a48635d16037c063c53c",
            "vulnerability_id": "4cc6c3ebe85614e5e2a3aede235558fca44e5240c1a50277f819b6b74df77089",
            "file_path": "id_rsa.pub",
            "action": "filename",
            "description": "Public key file",
            "comment": "Shell configuration files can contain passwords, API keys, hostnames and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/id_rsa.pub",
            "created_at": "2022-06-04T07:44:35.069Z",
            "updated_at": "2022-06-04T07:44:35.069Z"
          }
        ]
      }
    ]
  }
}
```
