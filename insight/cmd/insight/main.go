package main

import (
	"fmt"
	"net/http"

	"github.com/nguyenptk/vulnerability-scanner/insight/common/log"

	server "github.com/nguyenptk/vulnerability-scanner/insight/server/handlers"
	"github.com/nguyenptk/vulnerability-scanner/insight/storages/mysql"
)

func main() {
	// Initialize logger
	insight := &server.Insight{
		Logger: &log.Logger{},
	}

	// Initialize DB
	insight.MySQL = mysql.NewDatabase(insight.Logger)

	// Handle panic
	defer func() {
		if e := recover(); e != nil {
			err := fmt.Errorf("%v", e)
			insight.Logger.Debug("panic convert error %s", err)
		}
	}()

	http.HandleFunc("/report", insight.ReportHanlder)

	http.ListenAndServe(":9000", nil)
}
