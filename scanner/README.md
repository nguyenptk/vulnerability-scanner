## Scanner 
The Scanner is service that allow the client can request a scanning via API to scan the vulnerabilities of the repositories in Github. There are two types of repositories: `public & private`.

The private repository needs the `$GITHUB_TOKEN` to access and clone the repository.

Currently, Scanner supports only one API `/scan`

### How it works
The Scanner will: 
- authenticate to Github (private repository) and clone the repository to the local machine
- scan the vulnerability by the signature which is configured in `scanner/server/scanner/signatures/signatures.go`
- count the stats of vulnerabilities before logging them into the console log, return the result to client and save it to the database (MySQL)

### What the features are
The Scanner supports:
- multi repositories at one time scanning by `repos`
- scan in the target path of the repositories by `target`

### How to use
1. Public repository (There is a bug here -> not recommend using now)
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world"
```

2. Private repository
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world" \
          -H "token: $GITHUB_TOKEN"
```

3. Multi repositories (There is a bug here -> not recommend using now)
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world,guardrailsio/awesome-golang-security" \
          -H "token: $GITHUB_TOKEN"
```

4. In target path 
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world" \
          -H "token: $GITHUB_TOKEN"
          -H "target: test"
```

### What is the result
Please read the schema [here](/storage/README.md) firstly.
When the Scanner finds some vulnerabilities, the client will receive the body:
```
{
  "message": {
    "id": "5ca9b0a1-df9c-498a-b934-dbd7ac2a7b85",
    "queue_at": "2022-06-03T16:12:04.95177767Z",
    "started_at": "2022-06-03T16:12:04.951777336Z",
    "finished_at": "2022-06-03T16:12:06.028254962Z",
    "status": "Success",
    "progress": 100,
    "targets": 1,
    "repositories": 1,
    "findings": 3,
    "vulnerabilities": [
      {
        "id": "35dfc289c418d822957d7684781232379ab4da6414616842bc5c25825264f636",
        "report_id": "5ca9b0a1-df9c-498a-b934-dbd7ac2a7b85",
        "repository_name": "nguyenptk/hello-world",
        "repository_url": "https://api.github.com/repos/nguyenptk/hello-world",
        "findings": [
          {
            "id": "37495ca1621f4e7b96fce16716e093ee2cd5a8a1ba542ea2d7778dbe09799ba6",
            "vulnerability_id": "35dfc289c418d822957d7684781232379ab4da6414616842bc5c25825264f636",
            "file_path": "id_rsa.pub",
            "action": "filename",
            "description": "Public key file",
            "comment": "Shell configuration files can contain passwords, API keys, hostnames and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/id_rsa.pub"
          },
          {
            "id": "41e4420c81330a5f1b2bc2859d3a55baba7d76c28c49af226a7d00195ba430e9",
            "vulnerability_id": "35dfc289c418d822957d7684781232379ab4da6414616842bc5c25825264f636",
            "file_path": "test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test.log"
          },
          {
            "id": "1b9133669f274dbac7572782a12e0a97f376188f9ba55bc5a58d54371681df2a",
            "vulnerability_id": "35dfc289c418d822957d7684781232379ab4da6414616842bc5c25825264f636",
            "file_path": "test/test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test/test.log"
          }
        ]
      }
    ]
  }
}
```
Currently, I always let the Scanner returns status_code=200 and the error message is sent in the body. For examples:
```
{
  "message": [
    {
      "Code": 401,
      "Msg": "Error cloning repository nguyenptk/hello-world: authentication required\n"
    }
  ]
}
```
```
{
  "message": [
    {
      "Code": 403,
      "Msg": "Failed to gather target paths for repo: nguyenptk/hello-world"
    }
  ]
}
```

### How about the license
I cloned the core scanning from the repository https://github.com/grab/secret-scanner then I modified the core logic a bit and added a new HTTP wrapper.