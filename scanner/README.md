## Scanner 
The Scanner is service that allow the client can request a scanning via API to scan the vulnerabilities of the repositories in Github. There are two types of repositories: `public & private`.

The private repository needs the `$GITHUB_TOKEN` to access and clone the repository.

Currently, Scanner supports only one API `/scan`

### How it works
The Scanner will: 
- authenticate to Github (private repository) and clone the repository to the local machine
- scan the vulnerability by the signature which is configured in `scanner/server/scanner/signatures/signatures.go`
- count the stats of vulnerabilities before logging them into the console log, return the result to client and save it to the database (MySQL)

### What the features are
The Scanner supports:
- multi repositories at one time scanning by `repos`
- scan in the target path of the repositories by `target`

### How to use
1. Public repository (There is a bug here -> not recommend using now)
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world"
```

2. Private repository
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world" \
          -H "token: $GITHUB_TOKEN"
```

3. Multi repositories (There is a bug here -> not recommend using now)
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world,guardrailsio/awesome-golang-security" \
          -H "token: $GITHUB_TOKEN"
```

4. In target path 
```
curl -i -X GET "http://localhost:8090/scan" \
          -H "repos: nguyenptk/hello-world" \
          -H "token: $GITHUB_TOKEN"
          -H "target: test"
```

### What is the result
Please read the schema [here](/databases/README.md) firstly.
When the Scanner finds some vulnerabilities, the client will receive the body:
```
{
  "message": {
    "id": "48cd84d7-2be6-4344-b81f-293c02894aee",
    "queue_at": "2022-06-03T11:35:18.737578222Z",
    "started_at": "2022-06-03T11:35:18.737577889Z",
    "finished_at": "2022-06-03T11:35:21.534315584Z",
    "status": "Success",
    "targets": 1,
    "repositories": 1,
    "findings": 3,
    "vulnerabilities": [
      {
        "id": "cf70c6dbe9ef5606bfac4a3109b980b64e9ae42dfa4720a2a63917dffc08ccad",
        "report_id": "48cd84d7-2be6-4344-b81f-293c02894aee",
        "repository_name": "nguyenptk/hello-world",
        "repository_url": "https://api.github.com/repos/nguyenptk/hello-world",
        "findings": [
          {
            "id": "efef0ca6e1b060c7d1aa008228670a7658911ea54e9df16aeb6ac65aa78a051c",
            "vulnerability_id": "cf70c6dbe9ef5606bfac4a3109b980b64e9ae42dfa4720a2a63917dffc08ccad",
            "file_path": "test/test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test/test.log"
          },
          {
            "id": "2a7ce9fe2b35e22a9206beb6fab38bbf8922612b6c115767298d630fbce08c53",
            "vulnerability_id": "cf70c6dbe9ef5606bfac4a3109b980b64e9ae42dfa4720a2a63917dffc08ccad",
            "file_path": "id_rsa.pub",
            "action": "filename",
            "description": "Public key file",
            "comment": "Shell configuration files can contain passwords, API keys, hostnames and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/id_rsa.pub"
          },
          {
            "id": "85ffb38be4313400ff1d64290ec27210f00c6aa0858ef4c213f0c7d2950debfd",
            "vulnerability_id": "cf70c6dbe9ef5606bfac4a3109b980b64e9ae42dfa4720a2a63917dffc08ccad",
            "file_path": "test.log",
            "action": "extension",
            "description": "Log file",
            "comment": "Log files can contain secret HTTP endpoints, session IDs, API keys and other goodies",
            "file_url": "https://api.github.com/repos/nguyenptk/hello-world/blob/master/test.log"
          }
        ]
      }
    ]
  }
}
```
Currently, I always let the Scanner returns status_code=200 and the error message is sent in the body. For examples:
```
{
  "message": [
    {
      "Code": 401,
      "Msg": "Error cloning repository nguyenptk/hello-world: authentication required\n"
    }
  ]
}
```
```
{
  "message": [
    {
      "Code": 403,
      "Msg": "Failed to gather target paths for repo: nguyenptk/hello-world"
    }
  ]
}
```

### How about the license
I cloned the core scanning from the repository https://github.com/grab/secret-scanner then I modified the core logic a bit and added a new HTTP wrapper.