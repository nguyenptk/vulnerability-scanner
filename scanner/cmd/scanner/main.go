package main

import (
	"fmt"
	"net/http"

	"github.com/nguyenptk/vulnerability-scanner/scanner/common/log"

	server "github.com/nguyenptk/vulnerability-scanner/scanner/server/handlers"
	"github.com/nguyenptk/vulnerability-scanner/scanner/storages/mysql"
)

func main() {

	// Initialize logger
	scanner := &server.Scanner{
		Logger: &log.Logger{},
	}

	// Initialize DB
	scanner.MySQL = mysql.NewDatabase(scanner.Logger)

	// Handle panic
	defer func() {
		if e := recover(); e != nil {
			err := fmt.Errorf("%v", e)
			scanner.Logger.Debug("panic convert error %s", err)
		}
	}()

	http.HandleFunc("/scan", scanner.ScanHanlder)

	http.ListenAndServe(":8090", nil)
}
