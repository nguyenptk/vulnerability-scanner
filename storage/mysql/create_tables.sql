-- reports tables
CREATE TABLE IF NOT EXISTS `reports` (
  `id` varchar(255) NOT NULL,
  `queue_at` datetime(3) DEFAULT NULL,
  `started_at` datetime(3) DEFAULT NULL,
  `finished_at` datetime(3) DEFAULT NULL,
  `status` varchar(255),
  `progress` double DEFAULT NULL,
  `targets` int DEFAULT NULL,
  `repositories` int DEFAULT NULL,
  `findings` int DEFAULT NULL,
  `created_at` datetime(3) DEFAULT NULL,
  `updated_at` datetime(3) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; -- utf8mb4 is the “safest” character set as it also supports 4-byte unicode

-- vulnerabilities tables
CREATE TABLE IF NOT EXISTS `vulnerabilities` (
  `id` varchar(255) NOT NULL,
  `report_id` varchar(255),
  `repository_name` varchar(255),
  `repository_url` varchar(255),
  `created_at` datetime(3) DEFAULT NULL,
  `updated_at` datetime(3) DEFAULT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`report_id`) REFERENCES `reports`(`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; -- utf8mb4 is the “safest” character set as it also supports 4-byte unicode

-- findings tables
CREATE TABLE IF NOT EXISTS `findings` (
  `id` varchar(255) NOT NULL,
  `vulnerability_id` varchar(255),
  `file_path` varchar(255),
  `action` varchar(255),
  `description` varchar(255),
  `comment` varchar(255),
  `file_url` varchar(255),
  `line` bigint UNSIGNED DEFAULT NULL,
  `created_at` datetime(3) DEFAULT NULL,
  `updated_at` datetime(3) DEFAULT NULL,
  PRIMARY KEY (`id`),
  FOREIGN KEY (`vulnerability_id`) REFERENCES `vulnerabilities`(`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4; -- utf8mb4 is the “safest” character set as it also supports 4-byte unicode